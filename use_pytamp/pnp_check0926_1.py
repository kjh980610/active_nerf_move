#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import numpy as np
import math

from pykin.kinematics.transform import Transform
import pykin.utils.transform_utils  as tu



def printTr(h_mat1,h_mat2):
    print("pos")
    pos1 = tu.get_pos_mat_from_homogeneous(h_mat1)
    pos2 = tu.get_pos_mat_from_homogeneous(h_mat2)
    print(f"{pos1*100} \tnorm: {np.linalg.norm(pos1)*100}")
    print(f"{pos2*100} \tnorm: {np.linalg.norm(pos2)*100}")
    print(f"{(pos2-pos1)*100} \tnorm: {np.linalg.norm(pos2-pos1)*100}")
    # print("rot")
    # rpy1 = tu.get_rpy_from_matrix(h_mat1)
    # rpy2 = tu.get_rpy_from_matrix(h_mat2)
    # print(f"{rpy1} \tnorm: {np.linalg.norm(rpy1)}")
    # print(f"{rpy2} \tnorm: {np.linalg.norm(rpy2)}")
    # print(f"pose error: {tu.compute_pose_error(h_mat1,h_mat2)}")
    print()


tr = [[ 0, 1, 0, 0],
      [ 1, 0, 0, 0],
      [ 0, 0, 1, 0],
      [ 0, 0, 0, 1]]

cam1 = Transform( pos=[0.35607101050070894, -0.03281481986531434,0.5394820193054495],rot=[0.0007598816774595503, -0.7031620751204329, -0.7110129045777378, 0.004813337313288555]).h_mat
cam2 = Transform( pos=[0.34101573666480284, 0.05149035073620116,0.5400492507903587],rot=[0.0005312743283302856, 0.0053062835304154695, 0.9999838322116613, 0.0019739346399881797]).h_mat
cam3 = Transform( pos=[0.25805618528181334, 0.034954391340903404,0.5407251478806434],rot=[0.0036146931176864266, -0.7035776367355625, 0.7106079437101888, 0.0013391845440130024]).h_mat
cam4 = Transform( pos=[0.2760979897565249, -0.05170968541937707,0.5398723746831808],rot=[0.002489823379004193, 0.999982157796675, 0.005426863296548056, 0.0001844521827767568]).h_mat

cam1 = cam1.dot(tr)
cam2 = cam2.dot(tr)
cam3 = cam3.dot(tr)
cam4 = cam4.dot(tr)


pnp1=Transform( pos=[-0.10995061413748296, 0.04644748952642243,0.523656556318462],rot=[0.7107656654803461, -0.0003535879379602486, -0.01499403184833111, -0.7032689547810156]).h_mat
pnp2=Transform( pos=[-0.0557781269578714, -0.20456327934473809,0.5247636703278534],rot=[0.9998970035286144, 0.0051464858857868225, -0.01207791037607363, -0.005798284097300298]).h_mat
pnp3=Transform( pos=[0.19298863401134939, -0.14748352954908187,0.5284380107478461],rot=[0.7109904336207398, 0.011150583952877905, -0.010743692869816142, 0.7030311805608777]).h_mat
pnp4=Transform( pos=[0.128107270749659, 0.10153553739977982,0.5232194880357464],rot=[0.005806191275875112, -0.012293673349145296, -0.012918244654599882, -0.9998241208800157]).h_mat

pnp1=Transform( pos=[-0.10950937941906873, 0.08097371208367704,5.110478179366913],
 rot=[0.7103590040727508,-0.026062507496042907, -0.03613816617371919, -0.7024278354260948]).h_mat
pnp2=Transform( pos=[-0.05520943289491352, -0.16767411078450856,5.112515246139122],
 rot=[0.9963078205818139,-0.08533889059353501, -0.008301743731398152, -0.0043682319992225885]).h_mat
pnp4=Transform( pos=[0.12853947741548097, 0.13392647074693434,5.052745882472608],
 rot=[0.005472442178550272,-0.002417731998408006, -0.09823463154166852, -0.9951452979914334]).h_mat
pnp3=Transform( pos=[0.19389298726794746, -0.11199871256774717,5.153068669514165],
 rot=[0.7103459754722088,-0.00015801908277241354, -0.00832006946077656, 0.7038034857860349]).h_mat


cam2t1 = np.dot(np.linalg.inv(cam2),cam1)
cam3t2 = np.dot(np.linalg.inv(cam3),cam2)
cam4t3 = np.dot(np.linalg.inv(cam4),cam3)
cam1t4 = np.dot(np.linalg.inv(cam1),cam4)
cam1t3 = np.dot(np.linalg.inv(cam1),cam3)

pnp2t1=(np.linalg.inv(pnp2)).dot(pnp1)
pnp3t2=(np.linalg.inv(pnp3)).dot(pnp2)
pnp4t3=(np.linalg.inv(pnp4)).dot(pnp3)
pnp1t4=(np.linalg.inv(pnp1)).dot(pnp4)
pnp1t3=(np.linalg.inv(pnp1)).dot(pnp3)


# printTr(pnp2t1,cam2t1)
# printTr(pnp3t2,cam3t2)
# printTr(pnp4t3,cam4t3)
# printTr(pnp1t4,cam1t4)
# printTr(pnp1t3,cam1t3)

tcp1 = Transform(
pos=[0.3052945737677324, -0.0011797923265600614,0.48629574232459305],
rot=[-0.0028662435287049024, -0.9999727054574121, -0.005551365680159729, 0.003944024252340739]).h_mat
tcp2 = Transform(
pos=[0.3080449241076683, 0.0020486994064072978,0.48641856753100177],
rot=[0.0010178899351226613, -0.7108474635012744, -0.7033432429900331, -0.001769201556726364]).h_mat
tcp3 = Transform(
pos=[0.3079047383870337, 0.002332367784158046,0.4872580843168074],
rot=[0.0016121908779137255, 0.004971188816686178, 0.9999802086944274, 0.0035029047618927037]).h_mat
tcp4 = Transform(
pos=[0.3080745809112848, -0.0016259424461563116,0.48623546703859555],
rot=[-0.0016279189252807053, -0.7109315426595685, 0.7032567981592974, -0.001888749425471145]).h_mat

tcp2cam = Transform(
    pos=[-0.1, 0.15,-0.0534],
    rot=[-0.7071067811830096, 0, 0, 0.7071067811830093]).h_mat

tr = tcp2cam.dot(tr)


tcp1 = tcp1.dot(tr)
tcp2 = tcp2.dot(tr)
tcp3 = tcp3.dot(tr)
tcp4 = tcp4.dot(tr)


tcp2t1 = np.dot(np.linalg.inv(tcp2),tcp1)
tcp3t2 = np.dot(np.linalg.inv(tcp3),tcp2)
tcp4t3 = np.dot(np.linalg.inv(tcp4),tcp3)
tcp1t4 = np.dot(np.linalg.inv(tcp1),tcp4)
tcp1t3 = np.dot(np.linalg.inv(tcp1),tcp3)



printTr(pnp2t1,tcp2t1)
printTr(pnp3t2,tcp3t2)
printTr(pnp4t3,tcp4t3)
printTr(pnp1t4,tcp1t4)
printTr(pnp1t3,tcp1t3)

